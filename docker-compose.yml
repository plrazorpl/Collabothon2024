name: collabothon-demo

services:
  gateway:
    image: nginx:1.27.1-alpine
    ports:
    - "8080:80"
    environment:
      NGINX_PORT: '80'
    volumes:
    - type: bind
      source: ./gateway.conf
      target: /etc/nginx/nginx.conf
      read_only: true
    networks:
    - backend-mesh
    depends_on:
    - collabothon-api
    - vertex-api
    - frontend

  collabothon-api:
    environment:
      LOGGING__LOGLEVEL__DEFAULT: Trace
      STHFISHY__LOGSENSITIVE: 'false'
      STHFISHY__DATABASEFILE: /data/demo.db
      STHFISHY__VERTEX: http://vertex-api:8080/
      HTTP_PORTS: '80'
    env_file: backend.env
    image: collabothon-api:latest
    build:
      context: ./backend/
      dockerfile: ./SomethingFishy.Collabothon2024.API/Dockerfile
    user: root
    volumes:
    - collabothon-api-data:/data
    networks:
    - backend-mesh
    depends_on:
    - vertex-api

  vertex-api:
    image: collabothon-vertex-api:latest
    build:
      context: ./vertex-api
      dockerfile: Dockerfile
    networks:
    - backend-mesh

  frontend:
    image: collabothon-frontend:latest
    build:
      context: ./frontend
      dockerfile: Dockerfile
    networks:
    - backend-mesh
    depends_on:
    - collabothon-api
    - vertex-api

volumes:
  collabothon-api-data:

networks:
  backend-mesh:
